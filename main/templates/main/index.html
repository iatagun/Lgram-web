{% extends 'main/base.html' %}

{% block Generator %}
    {% if user.is_authenticated %}
        <form method="POST" id="textForm" onsubmit="return submitForm()">
            {% csrf_token %}
            <div class="mb-3">
                <textarea class="form-control" name="input_text" id="input_text" rows="2" placeholder="Enter a starting sentence for statistical text generation (processing may take several minutes)...">{{ request.POST.input_text }}</textarea>
            </div>
            
            <div class="row mb-2">
                <div class="col-4">
                    <div class="slider-group-compact">
                        <div class="slider-label-compact">
                            <span>Sentences:</span>
                            <span class="slider-value-compact" id="sentencesValue">{{ num_sentences|default:5 }}</span>
                        </div>
                        <input type="range" class="form-range-compact" name="num_sentences" id="num_sentences" value="{{ num_sentences|default:5 }}" min="1" max="10" oninput="updateSliderValue('sentencesValue', this.value)">
                        
                        <div class="slider-label-compact mt-2">
                            <span>Length:</span>
                            <span class="slider-value-compact" id="lengthValue">{{ length|default:13 }}</span>
                        </div>
                        <input type="range" class="form-range-compact" name="length" id="length" value="{{ length|default:13 }}" min="5" max="30" oninput="updateSliderValue('lengthValue', this.value)">
                    </div>
                </div>
            </div>
            
            <div class="text-center">
                <button type="submit" name="submit" value="submit" class="btn btn-primary" id="submitBtn">Generate Text</button>
            </div>
        </form>

        <div class="loading" id="loading">
            <div class="spinner-border spinner-border-sm" role="status">
                <span class="visually-hidden">Generating...</span>
            </div>
            <p>Generating text, please wait...</p>
        </div>
    {% else %}
        <div class="alert alert-info text-center">
            <h4><i class="fas fa-info-circle me-2"></i>Welcome to Centering-Lgram!</h4>
            <p class="lead">This is an educational platform demonstrating statistical language modeling techniques combined with Centering Theory.</p>
            <p class="mb-3">To explore our N-gram based text generation system, please sign in or create an account. <strong>Note:</strong> Text generation is computationally intensive and may take several minutes to complete.</p>
            <div class="mt-3">
                <a href="{% url 'login' %}" class="btn btn-primary me-2">
                    <i class="fas fa-sign-in-alt me-2"></i>Sign In
                </a>
                <a href="{% url 'register' %}" class="btn btn-success">
                    <i class="fas fa-user-plus me-2"></i>Create Account
                </a>
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block output %}
    {% if result %}
        <div class="result-box">
            <div class="d-flex justify-content-between align-items-start mb-2">
                <strong>Generated Text:</strong>
                <button type="button" class="btn btn-primary btn-sm" onclick="copyText('{{ result|escapejs }}', this)">üìã Copy</button>
            </div>
            <p><strong>Input:</strong> {{ request.POST.input_text }}</p>
            <p><strong>Output:</strong> {{ result }}</p>
            <small class="text-muted">Parameters: {{ request.POST.num_sentences|default:5 }} sentences, {{ request.POST.length|default:13 }} word length</small>
        </div>
    {% endif %}
{% endblock %}

{% block History %}
    {% if user.is_authenticated %}
        {% if history %}
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h6>Generation History ({{ history|length }} items)</h6>
                <button type="button" class="btn btn-danger btn-sm" onclick="clearHistory()">üóëÔ∏è Clear</button>
            </div>

            {% for item in history %}
                <div class="history-item">
                    <div class="d-flex justify-content-between align-items-start mb-1">
                        <small><strong>Date:</strong> {{ item.created_at|date:"M d, Y H:i" }}</small>
                        <button type="button" class="btn btn-primary btn-sm" onclick="copyText('{{ item.generated_text|escapejs }}', this)">üìã</button>
                    </div>
                    <p><strong>Input:</strong> {{ item.input_text }}</p>
                    <p><strong>Output:</strong> {{ item.generated_text }}</p>
                </div>
            {% endfor %}
        {% else %}
            <div class="text-center py-4">
                <h6 class="text-muted">No text generated yet</h6>
                <p class="text-muted">Start generating text from the Generate tab. Please allow sufficient time for the statistical model to process your request.</p>
            </div>
        {% endif %}
    {% else %}
        <div class="alert alert-warning text-center">
            <h5><i class="fas fa-history me-2"></i>Generation History</h5>
            <p>Please sign in to view your text generation history and track your experiments with the statistical language model.</p>
            <div class="mt-3">
                <a href="{% url 'login' %}" class="btn btn-primary me-2">
                    <i class="fas fa-sign-in-alt me-2"></i>Sign In
                </a>
                <a href="{% url 'register' %}" class="btn btn-success">
                    <i class="fas fa-user-plus me-2"></i>Create Account
                </a>
            </div>
        </div>
    {% endif %}
{% endblock %}

